<!DOCTYPE html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2011 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Maudite Momie!</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script src="/webcomponentsjs/webcomponents-lite.min.js"></script>

<link rel="import" href="/control/controller.html">
<link rel="import" href="/model/card.html">
<link rel="import" href="/ui/state_view.html">

<style>
  html,
  body {
    height: 100%;
  }

  body {
    -webkit-flex-direction: column;
    display: -webkit-flex;
    margin: 0;
    padding: 0;
  }
</style>
</head>
<body>
  <button>Next</button>
  <state-view></state-view>
  <script>
  'use strict';

  var c = new mm.c.Controller([1,2,3,4]);

  var moves = [
    c.performDrawCard.bind(c, 0),
    c.performDrawCard.bind(c, 1),
    c.performDrawCard.bind(c, 0),
    c.performDrawCard.bind(c, 1),

    c.performDrawCard.bind(c, 1),
    c.performDrawCard.bind(c, 0),
    c.performDrawCard.bind(c, 0),
    c.performScore.bind(c),

    c.performDenounce.bind(c, 1)
  ];
  var moveIndex = 0;

  function nextMove() {
    moves[moveIndex]();
    ++moveIndex;
    console.log(c.format(''));
    drawModel();
  }

  function drawModel() {
    var containerEl = document.querySelector('state-view');
    while (containerEl.firstChild)
      containerEl.removeChild(containerEl.firstChild);
    var stateViewEl = document.createElement('mm-ui-state-view');
    stateViewEl.setModel(c.model);
    containerEl.appendChild(stateViewEl);
  }

  function onLoad() {
    var buttonEl = document.querySelector('button');
    buttonEl.addEventListener('click', function() {
      nextMove();
    });
    drawModel();
  }
  window.addEventListener('load', onLoad);

  </script>
</body>
